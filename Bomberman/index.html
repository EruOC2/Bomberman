<!DOCTYPE html>
<html>

<head>
    <style>
        canvas {
            background-color: white;
        }

        body {
            background-color: black;
        }
    </style>
</head>

<body>

    <center>
        <canvas width="950" height="650" id="myCanvas"></canvas>
    </center>

    <script>
        var canvas = document.getElementById('myCanvas');
        var ctx = canvas.getContext('2d');
        var dir = 0, speed = 2;
        let pause = false;
        let bombLimit = 2; // Límite de bombas
        let bombs = [];


        class Cuadrado {
            constructor(x, y, w, h, c) {
                this.x = x;
                this.y = y;
                this.w = w;
                this.h = h;
                this.c = c;
            }

            paint(ctx) {
                ctx.fillStyle = this.c;
                ctx.fillRect(this.x, this.y, this.w, this.h);
            }

            seTocan(otro) {
                return this.x < otro.x + otro.w &&
                    this.x + this.w > otro.x &&
                    this.y < otro.y + otro.h &&
                    this.y + this.h > otro.y;
            }
        }

        class Player {
            constructor(x, y, width, height, color) {
                this.x = x;
                this.y = y;
                this.width = width;
                this.height = height;
                this.color = color;
            }

            update() {
                let prevX = this.x;
                let prevY = this.y;

                switch (dir) {
                    case 1:
                        this.y -= speed;
                        if (this.y < 0) {
                            this.y = canvas.height;
                        }
                        break;
                    case 2:
                        this.y += speed;
                        if (this.y > canvas.height) {
                            this.y = -this.height;
                        }
                        break;
                    case 3:
                        this.x += speed;
                        if (this.x > canvas.width) {
                            this.x = -this.width;
                        }
                        break;
                    case 4:
                        this.x -= speed;
                        if (this.x < -this.width) {
                            this.x = canvas.width;
                        }
                        break;
                }

                for (var i = 0; i < walls.length; i++) {
                    if (this.seToca(walls[i])) {
                        this.x = prevX;
                        this.y = prevY;
                        break;
                    }
                }
            }

            seToca(wall) {
                return this.x < wall.x + wall.w &&
                    this.x + this.width > wall.x &&
                    this.y < wall.y + wall.h &&
                    this.y + this.height > wall.y;
            }

            draw() {
                ctx.fillStyle = this.color;
                ctx.fillRect(this.x, this.y, this.width, this.height);
            }
        }

        class Bomba {
            constructor(x, y, w, h, color, fuseTime) {
                this.x = x;
                this.y = y;
                this.w = w;
                this.h = h;
                this.color = color;
                this.active = true; // Bomba activa
                this.fuseTime = fuseTime; // Tiempo en milisegundos antes de la explosión
                this.startTime = Date.now(); // Registrar el momento en que se creó la bomba
            }

            draw(ctx) {
                if (this.active) {
                    ctx.fillStyle = this.color;
                    ctx.fillRect(this.x, this.y, this.w, this.h);
                }
            }

            explode() {
                
                const tiempoActual = Date.now();
                if (tiempoActual - this.startTime >= this.fuseTime) {
                    
                    this.active = false;
                    
                }
            }
        }

        const player = new Player(0, 0, 40, 40, "black");
        let walls = [];
        

        //limites
        walls.push(new Cuadrado(-10, -10, 1000, 10, "gray"))
        walls.push(new Cuadrado(950, -10, 30, 700, "gray"))
        walls.push(new Cuadrado(-10, -10, 10, 700, "gray"))
        walls.push(new Cuadrado(0, 650, 1000, 10, "gray"))

        //mapa prmera fila de muros
        walls.push(new Cuadrado(50, 50, 50, 50, "gray"))
        walls.push(new Cuadrado(150, 50, 50, 50, "gray"))
        walls.push(new Cuadrado(250, 50, 50, 50, "gray"))
        walls.push(new Cuadrado(350, 50, 50, 50, "gray"))
        walls.push(new Cuadrado(450, 50, 50, 50, "gray"))
        walls.push(new Cuadrado(550, 50, 50, 50, "gray"))
        walls.push(new Cuadrado(650, 50, 50, 50, "gray"))
        walls.push(new Cuadrado(750, 50, 50, 50, "gray"))
        walls.push(new Cuadrado(850, 50, 50, 50, "gray"))


        //segunda fila
        walls.push(new Cuadrado(50, 150, 50, 50, "gray"))
        walls.push(new Cuadrado(150, 150, 50, 50, "gray"))
        walls.push(new Cuadrado(250, 150, 50, 50, "gray"))
        walls.push(new Cuadrado(350, 150, 50, 50, "gray"))
        walls.push(new Cuadrado(450, 150, 50, 50, "gray"))
        walls.push(new Cuadrado(550, 150, 50, 50, "gray"))
        walls.push(new Cuadrado(650, 150, 50, 50, "gray"))
        walls.push(new Cuadrado(750, 150, 50, 50, "gray"))
        walls.push(new Cuadrado(850, 150, 50, 50, "gray"))

        //tercera fila
        walls.push(new Cuadrado(50, 250, 50, 50, "gray"))
        walls.push(new Cuadrado(150, 250, 50, 50, "gray"))
        walls.push(new Cuadrado(250, 250, 50, 50, "gray"))
        walls.push(new Cuadrado(350, 250, 50, 50, "gray"))
        walls.push(new Cuadrado(450, 250, 50, 50, "gray"))
        walls.push(new Cuadrado(550, 250, 50, 50, "gray"))
        walls.push(new Cuadrado(650, 250, 50, 50, "gray"))
        walls.push(new Cuadrado(750, 250, 50, 50, "gray"))
        walls.push(new Cuadrado(850, 250, 50, 50, "gray"))

        //cuarta fila
        walls.push(new Cuadrado(50, 350, 50, 50, "gray"))
        walls.push(new Cuadrado(150, 350, 50, 50, "gray"))
        walls.push(new Cuadrado(250, 350, 50, 50, "gray"))
        walls.push(new Cuadrado(350, 350, 50, 50, "gray"))
        walls.push(new Cuadrado(450, 350, 50, 50, "gray"))
        walls.push(new Cuadrado(550, 350, 50, 50, "gray"))
        walls.push(new Cuadrado(650, 350, 50, 50, "gray"))
        walls.push(new Cuadrado(750, 350, 50, 50, "gray"))
        walls.push(new Cuadrado(850, 350, 50, 50, "gray"))

        //quinta fila
        walls.push(new Cuadrado(50, 450, 50, 50, "gray"))
        walls.push(new Cuadrado(150, 450, 50, 50, "gray"))
        walls.push(new Cuadrado(250, 450, 50, 50, "gray"))
        walls.push(new Cuadrado(350, 450, 50, 50, "gray"))
        walls.push(new Cuadrado(450, 450, 50, 50, "gray"))
        walls.push(new Cuadrado(550, 450, 50, 50, "gray"))
        walls.push(new Cuadrado(650, 450, 50, 50, "gray"))
        walls.push(new Cuadrado(750, 450, 50, 50, "gray"))
        walls.push(new Cuadrado(850, 450, 50, 50, "gray"))

        //sexta fila
        walls.push(new Cuadrado(50, 550, 50, 50, "gray"))
        walls.push(new Cuadrado(150, 550, 50, 50, "gray"))
        walls.push(new Cuadrado(250, 550, 50, 50, "gray"))
        walls.push(new Cuadrado(350, 550, 50, 50, "gray"))
        walls.push(new Cuadrado(450, 550, 50, 50, "gray"))
        walls.push(new Cuadrado(550, 550, 50, 50, "gray"))
        walls.push(new Cuadrado(650, 550, 50, 50, "gray"))
        walls.push(new Cuadrado(750, 550, 50, 50, "gray"))
        walls.push(new Cuadrado(850, 550, 50, 50, "gray"))



        window.requestAnimationFrame = (function () {
            return window.requestAnimationFrame ||
                window.webkitRequestAnimationFrame ||
                window.mozRequestAnimationFrame ||
                function (callback) {
                    window.setTimeout(callback, 17);
                };
        }());

        document.addEventListener("keydown", (e) => {
            if (!pause) {
                switch (e.keyCode) {
                    case 87:
                        dir = 1;
                        break;
                    case 83:
                        dir = 2;
                        break;
                    case 68:
                        dir = 3;
                        break;
                    case 65:
                        dir = 4;
                        break;
                    case 69: // Tecla "E" para crear una bomba
                        if (bombs.length < bombLimit) {
                            bombs.push(new Bomba(player.x, player.y, 20, 20, "red", 1000)); // Bomba con 3000 milisegundos de mecha
                        }
                        break;
                }
            }
        });

        document.addEventListener("keyup", (e) => {
            dir = 0;
        });

        function update() {
            if (!pause) {
                player.update();
            }
            updateBombs(); // Actualizar estado de las bombas
            paint();
            window.requestAnimationFrame(update);
        }

        function updateBombs() {
            // Actualizar el estado de las bombas
            for (let i = 0; i < bombs.length; i++) {
                bombs[i].explode(); // Verificar si la bomba debe explotar
                if (!bombs[i].active) {
                    // Si la bomba no está activa (explotó o desapareció), quitarla de la lista de bombas
                    bombs.splice(i, 1);
                    i--; // Disminuir el índice para evitar problemas de iteración
                }
            }
        }

        function paint() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);

            // Dibuja las bombas
            for (let i = 0; i < bombs.length; i++) {
                bombs[i].draw(ctx);
            }

            player.draw();

            for (var i = 0; i < walls.length; i++) {
                walls[i].paint(ctx);
            }

            if (pause) {
                ctx.fillStyle = "rgba(154,160,154,0.5)";
                ctx.fillRect(0, 0, canvas.width, canvas.height);

                ctx.font = "40px Georgia";
                ctx.fillStyle = "black";
                ctx.fillText("P A U S E", 185, 225);
            }
        }

        update(); // Iniciar el bucle del juego

    </script>
</body>

</html>
